in this tutorial I'm going to teach you how to add in-app purchases to react native for iOS I have experimented with several third-party libraries so in this tutorial I'm going to be using react native IAP I actually use it for my app in the app store it's a live app it works perfectly and I use it for monthly and yearly subscriptions so I thought I would share with you guys how to do that I hope you guys like this if you do please don't forget to hit the Subscribe button and don't forget to hit the like button okay so let's get started so before you get started you will need an apple developer account it costs about a hundred dollars a year I think the last time I remember um the price may have gone up slightly you'll need a MacBook with xcode and you'll need an iPhone or iPad to test in-app purchases as of this recording you cannot test those on a simulator so just to start off I'm going to show you guys a demo of the finished app this is a screen recording from my device so I've got a subscription I subscribe I should get this sandbox notification that it's a test and it should let me go ahead and sign in if everything is set up correctly and there we have it I should get a message that I'm subscribed and it'll take me to whatever screen I've set up after a user has subscribed to my app so as always the first thing we need to do is create and initialize a new project in react native so to do that I'm going to open my terminal into a directory where I want to create this project and I'm going to run the command npx react native init and then whatever the project name is all right we're going to let that run once that's done I'm gonna go ahead and CD into the directory of that project and then I'm going to go ahead and run npmi to install all the default dependencies for react native and then I'm gonna run npmi react native IAP to install the in-app purchase dependency and I'm gonna pass dash dash save so it can save it to my packages.json then I'm going to CD into iOS and run pod install you can also run npx pod install as well but this is just another way to do it now I'm going to go ahead and go back to the project directory and in here I'm going to run npx react native run iOS and bring up the app and make sure everything is running as expected okay now we can see our app is running everything is set up and now the next step we're going to open our project in xcode and to do that I'm going to go into my file explorer into that directory and then in the iOS you should have a file with the extension XC workspace I open that in xcode then you go to your project signing and capabilities and we're gonna click on the capabilities and look for in-app purchase we're going to add the in-app purchase also make sure you change your bundle identifier and you select your team for your Apple developer account next I'm going to log in to my Apple developer account and then once I'm logged in I'm going to go to the identifiers here in the second column and I'm just going to make sure that whatever I chose for my identifier in xcode shows up here as well mine looks fine I've been testing this a lot so let's go ahead and go to apps and as you can see I already have an app here this is the one I'm actually using and app purchases but I'm going to create a new app by clicking on that plus icon and here I'm just adding a name you can add whatever you want to call yours choose that bundle ID if you don't see it you should have a link to go in an add it manually in your developer account but I see mine so I go ahead and select it then you'll add a skew here I'm gonna say full access I'm selecting iOS for the platform and then I'm just going to go ahead and create that all right so I have an error here that the sku's already been used because I've been testing this a lot so I'm just going to change the skew because this does have to be unique among all your apps all right so I went ahead and created my app now we're gonna go through our settings here in apple developer and we're gonna go ahead and let's go to the subscriptions under the features on the left hand menu we're going to create a subscription group and you can call it whatever you want I'm just going to call it cwg subscription group for this demo then it'll take us to the screen to add a subscription so here if you just look at the help menu this subscription name reference name is for you the user or they don't see it in the App Store this is just the identifier for you for analytics Etc and same with the product ID so you can choose anything you want but note that product IDs have to be unique so if you did delete this see I'm getting an error here actually I shouldn't use a hyphen they do have to be unique so if you've used it before you won't be able to use it again even if you delete it it won't let you reuse a deleted product ID so just keep that in mind now that we've got the group and the subscription set up it'll take me to this screen here where I'm going to select the duration I'm going to select a localization price and I'm gonna select 299 and for the countries and localities I'm just going to let this set this to the default but you guys can go through and do your calculation for a real app to make sure these prices are set correctly for your requirements and then we also need to add app store localization and I'm going to go ahead and just now this name is displayed to in the App Store so make sure the display name in the description here are what you want the user to see so I'm just gonna put some test stuff in here I'm not going to worry about it too much of course for your requirements make sure you put some good descriptions and a meaningful display name all right now that we have all of that set up the next thing we need to do if I scroll here um let's go actually here's a warning here that I need to add localization also in my app so if I go back to the group here's App Store localization this is different so go ahead and make sure you add this as well same thing I'm going to add a subscription group display name same this does get displayed make sure you look at this help text before you fill these things out I'm going to leave my app uh name displayed to the whatever my app is all right so now that we've got the app store localization and the pricing localization all set up there's one more thing we need to do to get this um ready for us to be able to use there's still some missing metadata here so let's see what we need to do uh uh let's look at let's actually add an introductory price here I'm going to go and just so you guys can see how to do that I'm just selecting some free for one week and I'm gonna add it for all countries that's fine just so you guys can see how we can add an introductory price um you can even add offer codes promotions there's some cool flexibility you can do with these subscriptions all right so we've got that there are still a few things here uh let's look at this review information here we do need to add some type of image this is for review only it isn't displayed in the App Store at all but you will need this is required for your subscription to be approved by the App Store so make sure you upload a image and you can put some review notes so that the person reviewing it can understand what your subscription is so for me I would probably just kind of describe what that subscription is for and then I'm going to go ahead and save this and all right so now we have our app says it's ready to submit so great now that our subscription is ready we will be able to use the subscription the first time we submit our app to the App Store we'll be able to select this subscription for our app so make sure it says ready for submit all right so let's go look at this app information here if you scroll down just make sure you've set everything up I'm just double checking now one thing I'm going to add is a app specific shared secret we do need this to test our app and our device so I'm going to copy the shirt secret and save it all right now I'm going to open my project in vs code and I'm going to create a DOT EnV file and copy that shared secret or add it to my environment variables so I'm just gonna right click new file and it's dot EnV okay looks like I already have one here so I'm just gonna go ahead and add my uh before I do that I'm going to go to this dot get ignore and for my my code is in GitHub so if you do have that make sure you add your dot EnV so that you don't accidentally check that into GitHub because you don't want to share this a secret key with anybody so I'm going to call my environment variable app all right so now that we have that I'm going to go back and copy that because I somehow didn't have it so go ahead and paste that into my app secret environment variable all right so now I'm going to open a terminal nvs code because I do need to install a react native.env so that I can use this environment variable in my code so I'm just going to run npm install react native react actually I'm going to do npm install uppercase D so that this is only installed for development environment I don't need it in production so then it's uh npm install D and then react native dot EnV and go ahead and return all right so now that that's saved let's go to um code with GG .com and I have a full article of every instruction that I'm going through in this video and you can follow along with me but if you pull it up I have all the code everything you need to get this thing working so now this is to add all the dependencies so we need a few more things we need react navigation uh and we also need the gesture Handler so I'm going to just go ahead and copy paste these lines of code to install a few more things so the next thing I need is uh the screens so I'm just going to go ahead and copy these really quick and if you guys want to follow along just go ahead and open codewithg.com and you'll see the first article is instructions for adding in-app purchases to react native all right and let's go ahead last thing we need to run the Pod install so I'm just copying and pasting these commands into my terminal from my article so let's go ahead and run pod install which is npx POD install iOS alright so the next thing we need is a new file called subscriptions and I have the code for you on this link and I'll leave that link in the description of this video as well I've got all the code all the files you'll need so I'm just going to go through and copy all this code and create these files step by step so you guys can see so let's grab the subscriptions.js code go back to your vs code create a new file and this is going to be actually I'm going to create a directory called source and side Source I'm going to create a another directory called screens and then inside the screens directory I'm going to create a new file called subscriptions.js and I'm just going to go ahead and paste that code into this all right the next thing I'm going to grab is the home.js code so I'm copying that go back to your screens directory in vs code create a new file called home.js I'm going to paste that code in here and then I'm going to go and grab app.tsx and go ahead and copy that and go back to our code app.tsx and I'm going to paste that in and save that let's see we've got a syntax error here all right so looks like something's wrong with my import statement here this should be an uppercase H there we go that looks better let's go ahead and save this it looks like I have another error here with the image let's go ahead and comment that out because we don't have that image all right so that fixes our syntax errors and now our subscription screen is being displayed which is exactly what we wanted um there's an error down on the device but you can ignore that that's because we can't run uh we can't access some of the subscription data on a simulator it has to be run on a device so that's a valid error you can ignore it so here's where I'm importing some methods from react native IAP that we're going to be using in here to get the data we need to display the subscriptions from our Apple developer configuration that we set up earlier we also need to import the iTunes shared secret from our DOT EnV file remember when we set that up here we added iTunes shared Secret so we will need that to access that data in our Apple developer account and so here I've got a product ID that I need to set to grab whatever data I need to display the subscription in my app so if you go back to your Apple developer account and look at your subscriptions the product ID go ahead and copy that product ID and I'm going to make sure this is the same and go ahead and paste that in so we've got our subscription skus for iOS so platform dot select is the method we call and we pass it an object for IOS and Android as you can see it's asking me to sign in with my developer account and it's also displaying the data for that subscription the cwg 299 product ID so it says you are subscribed to this plan because I've already subscribed to it or this might be an error so let's see uh let me remove this condition here says if owned you are subscribed and I had if not oh so I obviously don't own this app I haven't purchased it yet so I go ahead and fix that code all right so now that we have our subscription here are the methods we're using I'm using the use IAP hook which gives me access to all these different methods I put them in comments so you can see like subscriptions returns subscriptions for this app get subscriptions gets the available subscriptions current purchase finish transaction get purchase history and we are using most of these or all of these in this app so the first thing we check is if the user is connected if they are or if we're connected to the App Store if we are then we go ahead and get the purchase history then we check to see if the user is subscribed and if they are then we go ahead and navigate them to the home page so they don't have to see the subscription page because they've already subscribed so it's handling that navigation and then we've got of course the button to handle the purchase if they have not purchased it so Handle by we go ahead and purchase the subscription and that method and then if they have the receipt you can actually get the receipt data of course for you you can go ahead and store that receipt or whatever you need to do for your apps requirements let's go ahead and test this out to do that go back to your app develop Apple developer account and I'm going to go ahead and select the users and access here so go into users and access and you're going to go to sandbox testers and you can see I have several testers here just a little trick if you guys have a Gmail account if you put your name with a plus and a number then it'll forward that to your Gmail account so you can create as many testers as you need to which is what you might need to do so create your tester account because you're going to be using this on your actual device once you set that up you'll need to go to your device and sign in with that sandbox tester so when you add it here you'll get an email to verify it and log in it'll actually create an Apple ID for that tester so now if I go in here and I've got xcode here if I log in this is on my device I've got a screen recording and I'm able to test my app this looks great everything looks like it's working perfectly um here in a minute it should say oh congratulations or your subscription was successful so it does take a little while so you might want to display some kind of loading or whatever there we go it says you're all set and my app will navigate me to the home page once I'm logged in so if there you run into any issues I did have a couple of small issues myself so I made notes of it on code with GG if you guys want to go look in there just to make sure if you get the same errors you might be able to go ahead and solve it the same way that I did but other than that I think this is pretty complete now on my end I hope you guys find this useful I hope it works for you if not leave me a comment sure if somebody's gonna have some kind of an issue with this because it's tedious it's not difficult but it is tedious there's a lot of things going on here so hope you guys enjoyed it please don't forget to hit the Subscribe button and the like button and I'll see you in the next episode thanks for watching